<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Geoscatter Plot</title>
		<script src="https://d3js.org/d3.v5.min.js"></script>
		<style>
			/* Add any additional styling here */
		</style>
	</head>
	<body>
		<div id="map"></div>
		<div id="timeline"></div>

		<script>
			d3.json("data/globe/world.json").then(function (worldData) {
				const world = worldData;
				console.log(world);

				// Sample data
				const data = [
					{
						longitude: -74.006,
						latitude: 40.7128,
						val1: 10,
						val2: 15,
					},
					// Add more data for different locations and years
				];

				// Set up the map dimensions
				const width = 800;
				const height = 500;

				// Set up the projection
				const projection = d3
					.geoNaturalEarth1()
					.scale(150)
					.translate([width / 2, height / 2]);

				// Create SVG container for the map
				const svg = d3
					.select("#map")
					.append("svg")
					.attr("width", width)
					.attr("height", height);

				// Create a timeline
				const years = ["Year1", "Year2", "Year3"]; // Add your actual year values
				const timelineScale = d3
					.scaleBand()
					.domain(years)
					.range([0, width]);

				const timeline = d3
					.select("#timeline")
					.append("svg")
					.attr("width", width)
					.attr("height", 50)
					.append("g")
					.attr("transform", "translate(0,20)");

				timeline
					.selectAll("rect")
					.data(years)
					.enter()
					.append("rect")
					.attr("x", (d) => timelineScale(d))
					.attr("width", timelineScale.bandwidth())
					.attr("height", 20)
					.style("fill", "steelblue") // Customize the color as needed
					.on("click", updateMap);

				// Create a zoom behavior
				const zoom = d3
					.zoom()
					.scaleExtent([1, 8])
					.on("zoom", handleZoom);

				svg.call(zoom);

				// Draw the map
				const path = d3.geoPath().projection(projection);
				svg.selectAll("path")
					.data(world.features)
					.enter()
					.append("path")
					.attr("d", path);

				// Update the map based on the selected year
				function updateMap(year) {
					// Implement your logic to update the scatter plot based on the selected year
					// You can filter the data for the selected year and update the circles accordingly
				}

				// Handle zoom behavior
				function handleZoom() {
					svg.selectAll("circle")
						.attr("transform", d3.event.transform)
						.attr("r", 5 / d3.event.transform.k);
					console.log(d3.event.transform)
					svg.selectAll("path").attr("transform", d3.event.transform);
				}

				// Add scatter plot points
				svg.selectAll("circle")
					.data(data)
					.enter()
					.append("circle")
					.attr("cx", (d) => projection([d.longitude, d.latitude])[0])
					.attr("cy", (d) => projection([d.longitude, d.latitude])[1])
					.attr("r", 5)
					.attr("fill", "red") // Customize the color as needed
					.on("mouseover", handleMouseOver)
					.on("mouseout", handleMouseOut);

				// Handle mouseover event
				function handleMouseOver(d) {
					// Implement tooltip or other interactions on mouseover
					console.log("Mouseover:", d);
				}

				// Handle mouseout event
				function handleMouseOut(d) {
					// Implement actions on mouseout
					console.log("Mouseout:", d);
				}
			});
		</script>
	</body>
</html>
